- name: MAJ appconfig.py
  become_user: devops
  become: true
  lineinfile:
    path: ~/app/quizz/src/config/appconfig.py
    regexp: '^(.*)app\.config\[(.*)$'
    line: "    app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql+pymysql://{{ userdb }}:{{ pwddb }}@{{ dnsdb }}/{{ namedb }}'"
    backrefs: yes

- name: run qcm ~/app/quizz/script/start-quizz.sh
  become_user: devops
  become: true
  shell: 'nohup ~/.local/bin/pipenv run python3 api/app.py > /tmp/nohup.out 2>&1 &'
  args:
    chdir: ~/app/quizz/src
    executable: /bin/bash