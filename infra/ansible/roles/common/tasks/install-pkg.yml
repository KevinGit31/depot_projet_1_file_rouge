- name: Install python3.x86_64
  yum:
    name: python3.x86_64
    state: present
    update_cache: true

- name: Install python3-pip.noarch
  yum:
    name: python3-pip.noarch
    state: present
    update_cache: true

- name: Install python3-devel.x86_64
  yum:
    name: python3-devel.x86_64
    state: present
    update_cache: true

- name: Install mysql
  yum:
    name: mysql
    state: present
    update_cache: true

- name: Install MySQL-python
  yum:
    name: MySQL-python
    state: present
    update_cache: true

- name: Install python2-pip
  yum:
    name: python2-pip
    state: present
    update_cache: true

- name: Install lxml pour ansible nexus module
  pip:
    name: lxml
    executable: pip3

- name: Install flask
  pip:
    name: flask
    executable: pip3
    extra_args: --user

- name: Install pymysql
  pip:
    name: pymysql
    executable: pip3
    extra_args: --user
    
- name: Install pymysql
  pip:
    name: pymysql
    executable: pip2
    extra_args: --user

- name: Install python3.9 pour pipenv
#  become_user: devops
  become: true
  yum:
    name: "{{ item }}"
    state: present
    update_cache: true
  with_items:
    - gcc
    - openssl-devel
    - bzip2-devel
    - libffi-devel
    
- name: Install python3-devel.x86_64
  yum:
    name: sqlite-devel.x86_64
    state: present
    update_cache: true

- name: Check for node.js
    vars:
      node_version: "14.17.0"
    shell: test "$(node -v 2> /dev/null)" = v{{node_version}}
    register: nodejs_installed
    ignore_errors: True
    tags:
      - nodejs

- name: Create temp dir for compiling node.js
    vars:
      node_version: "14.17.0"
    shell: mktemp -d node.XXXXXXX
    register: node_tmp_dir
    when: nodejs_installed|failed
    tags:
      - nodejs

- name: Download node.js source
    vars:
      node_version: "14.17.0"
    shell: curl http://nodejs.org/dist/v{{node_version}}/node-v{{node_version}}.tar.gz | tar xz --strip-components=1 chdir={{ node_tmp_dir.stdout }}
    when: nodejs_installed|failed
    tags:
      - nodejs

- name: Configure, build and install node.js
    vars:
      node_version: "14.17.0"
    shell: ./configure && make && make install chdir={{ node_tmp_dir.stdout }}
    when: nodejs_installed|failed
    tags:
      - nodejs

- name: Cleanup node.js source
    vars:
      node_version: "14.17.0"
    shell: rm -rf {{ node_tmp_dir.stdout }}
    when: nodejs_installed|failed
    tags:
      - nodejs
 