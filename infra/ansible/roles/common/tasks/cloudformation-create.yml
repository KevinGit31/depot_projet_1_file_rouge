---
- name: create a cloudformation stack
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
  - name: create a cloudformation stack task
    sh: aws --region "{{ REGION }}" cloudformation create-stack --template-body file://depot_projet_1_file_rouge/infra/aws_cloudformation/instancegrp3.yaml --stack-name "{{ TypeName }}" --parameters "ParameterKey=KeyName,ParameterValue={{ KEYNAME }}  ParameterKey=Environnement,ParameterValue={{ ansible_environnement }} ParameterKey=RootKey,ParameterValue=\"\" ParameterKey=JenkinsKey,ParameterValue=\"\" ParameterKey=AnsibleKey,ParameterValue=\"\" ParameterKey=DevOpsKey,ParameterValue={{ secret_devops }} ParameterKey=SubnetIdPub,ParameterValue={{ SubnetIdPub }} ParameterKey=SubnetIdPriv,ParameterValue={{ SubnetIdPriv }} ParameterKey=VpcId,ParameterValue={{ VpcId }} ParameterKey=PrivateIP,ParameterValue={{ PrivateIP }} ParameterKey=TypeName,ParameterValue={{ TypeName }} ParameterKey=IngressPort,ParameterValue={{ IngressPort }} ParameterKey=SecurityGroupNameList,ParameterValue={{ SecurityGroupNameList }} ParameterKey=Urlscript,ParameterValue={{ Urlscript }} ParameterKey=SecurityGroupId,ParameterValue={{ SecurityGroupId }} ParameterKey=InstanceType,ParameterValue={{ InstanceType }}"
    register: stack
  - name: stack outputs
    debug: msg="Stack outputs are {{stack.stack_outputs}}"