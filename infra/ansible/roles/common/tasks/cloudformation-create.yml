---
- name: create a cloudformation stack
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
  - name: create a cloudformation stack task
    shell: aws cloudformation create-stack --template-body file://infra/aws_cloudform/instancegrp3.yaml --stack-name "{{ TypeName }}" --region "{{ REGION }}" --parameters ParameterKey=KeyName,ParameterValue="{{ KEYNAME }}" ParameterKey=Environnement,ParameterValue="{{ ansible_environnement }}" ParameterKey=RootKey,ParameterValue="{{ RootKey }}" ParameterKey=JenkinsKey,ParameterValue="{{ JenkinsKey }}" ParameterKey=AnsibleKey,ParameterValue="{{ AnsibleKey }}" ParameterKey=DevOpsKey,ParameterValue="{{ secret_devops }}" ParameterKey=SubnetIdPub,ParameterValue="{{ SubnetIdPub }}" ParameterKey=SubnetIdPriv,ParameterValue="{{ SubnetIdPriv }}" ParameterKey=VpcId,ParameterValue="{{ VpcId }}" ParameterKey=PrivateIP,ParameterValue="{{ PrivateIP }}" ParameterKey=TypeName,ParameterValue="{{ TypeName }}" ParameterKey=IngressPort,ParameterValue="{{ IngressPort }}" ParameterKey=SecurityGroupNameList,ParameterValue="{{ SecurityGroupNameList }}" ParameterKey=Urlscript,ParameterValue="{{ Urlscript }}" ParameterKey=SecurityGroupId,ParameterValue="{{ SecurityGroupId }}" ParameterKey=InstanceType,ParameterValue="{{ InstanceType }}" ParameterKey=AWSAccessKeyId,ParameterValue="{{ AWSAccessKeyId }}" ParameterKey=AWSSecretAccessKeyId,ParameterValue="{{ AWSSecretAccessKeyId }}"
    register: stack
  - name: stack outputs
    debug: msg="Stack outputs are {{stack.stack_outputs}}"